<div class="shop"></div>

<script>
    // Initialize store.json
    var store = []
    $.ajax({
        url: 'js/store.json',
        dataType: 'json',
        async: false,
        success: function(storeJSON) {
            store = storeJSON
        }
    })
    for (i in store) {
        $('.shop').append(`
            <div class="prod-group" p-grp="${i}">
                <div class="p-g-name">${i}</div>
            </div>
        `)
        for (j in store[i])
            $(`.prod-group[p-grp="${i}"]`).append(`
                <div
                    class="product"
                    p-id="${store[i][j].id}"
                    p-paypal='${JSON.stringify(store[i][j].paypal)}'
                    p-desc="${store[i][j].description}"
                    p-mat="${store[i][j].material}"
                >
                    <span class="p-img" p-img=${store[i][j].image}>
                        <span class="p-img-hover">
                            <p class="buyNow">Buy Now!</p>
                        </span>
                        <span class="p-img-carousel"></span>
                    </span>
                    <p class="p-name">${store[i][j].name}</p>
                    <p class="p-price">${store[i][j].price}</p>
                </div>
            `)
        $(`.prod-group[p-grp="${i}"]`).append('<div class="prod-info"></div>')
    }
    // Product Details
    $('.product').each(function() {
        // Product Image
        p_img = $('.p-img', this).attr('p-img').split(',')
        $('.p-img', this).css({
            'background-image': `url('img/store/${p_img[0]}')`
        })
        $('.p-img-carousel', this).hide().html('')
        for (i in p_img)
            $('.p-img-carousel', this).append(`<i></i>`)
        $('.p-img-carousel i', this).each(function() {
            $(this).mouseenter(() => {
                p_img_hover = $(this).parent().parent().attr('p-img').split(',')
                $('.p-img-carousel i').removeClass('active')
                $(this).addClass('active')
                $(this).parent().parent().css({
                    'background-image': `url('img/store/${p_img_hover[$(this).index()]}')`
                })
            })
        })
        // Open Product Info
        $(this).click(() => { if (!$(this).hasClass('detailed')) {
            $(this).parent().find('.product').removeClass('detailed').hide()
            $(this).addClass('detailed').show()
            $('.p-img-carousel', this).show()
            $('.p-img-hover', this).hide()
            if ($(this).attr('p-paypal') != 'undefined')
                $(this).parent().find('.prod-info')
                    .html(`
                        <i class="close-p-i"><i>×</i></i>
                        <p class="p-desc">${$(this).attr('p-desc')}</p>
                        <p class="p-mat">${$(this).attr('p-mat')}</p>
                        <select
                            class="options"
                            p-paypal="${$(this).attr('p-paypal')}"
                        ></select>
                        <select
                            class="sizes"
                            p-paypal='${$(this).attr('p-paypal')}'
                        >
                            <option disabled default selected>Choose Size...</option>
                            <option value="xs">XS</option>
                            <option value="s">S</option>
                            <option value="m">M</option>
                            <option value="l">L</option>
                        </select>
                        <a class="addToCart">Add To Cart</a>
                        <span class="special">*Domestic shipping only</span>
                    `)
                    .show()
            else
                $(this).parent().find('.prod-info')
                    .html(`
                        <i class="close-p-i"><i>×</i></i>
                        <p class="p-desc">${$(this).attr('p-desc')}</p>
                        <p class="p-mat">${$(this).attr('p-mat')}</p>
                        <a href="mailto:hnyadesign@gmail.com" class="addToCart">Email Now!</a>
                    `)
                    .show()
            // Product Options & Sizes
            $(this).parent().find('.sizes').each(function() {
                options = JSON.parse($(this).attr('p-paypal'))
                for (i in options)
                    $(this).parent().find('.options').append(`
                        <option value="${i}">${i.split('|')[0]}</option>
                    `)

            })
            function changePayPal() {
                chosenProduct = JSON.parse($(this).parent().find('.sizes').attr('p-paypal'))[$(this).parent().find('.options').val()][$(this).parent().find('.sizes').val()]
                $(this).parent().parent().find('.detailed .p-img .p-img-carousel').find('i').eq($(this).parent().find('.options').val().split('|')[1]).mouseenter()
                $(this).parent().find('.addToCart').attr('href', chosenProduct)
            }
            $(this).parent().find('.options').change(changePayPal)
            $(this).parent().find('.sizes').change(changePayPal)
            // Show Shopping Cart
            $(this).parent().find('.addToCart').click(() => {
                cart = true
                localStorage.setItem('cart', cart)
                shoppingCart()
            })
            // Close Product Info
            $this = $(this)
            $(this).parent().find('.close-p-i').click(() => {
                $(this).parent().find('.product').removeClass('detailed')
                $(this).parent().find('.prod-info').hide()
                $(this).parent().find('.p-img-carousel').hide()
                $(this).parent().find('.product, .p-img-hover').show()
            })
            $(document).keydown(function(e) {
                if (e.which == 27) $('.close-p-i').click()	// esc
            }) }
        })
    })

    cart = localStorage.getItem('cart')
        if (cart == null) cart = false
    function shoppingCart() {
        if (cart) $('header #cart').addClass('added')
        else $('header #cart').removeClass('added')
    }
    shoppingCart()

    appendFooter()
</script>
